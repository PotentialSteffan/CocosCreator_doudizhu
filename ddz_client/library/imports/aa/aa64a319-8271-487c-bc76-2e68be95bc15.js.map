{"version":3,"sources":["../../../../../../assets/scripts/gameScene/prefabs/assets/scripts/gameScene/prefabs/player_node.js"],"names":["cc","Class","extends","Component","properties","account_label","Label","nickname_label","room_touxiang","Sprite","globalcount_label","headimage","readyimage","Node","offlineimage","card_node","card_prefab","Prefab","clockimage","qiangdidzhu_node","time_label","robimage_sp","SpriteFrame","robnoimage_sp","robIconSp","robIcon_Sp","robnoIcon_Sp","masterIcon","onLoad","active","node","on","event","bind","console","log","accountid","myglobal","playerData","accountID","pushCard","detail","state","qian_state","qian","buqiang","start","init_data","data","index","JSON","stringify","string","nick_name","goldcount","cardlist_node","seat_index","isready","str","avatarUrl","head_image_path","loader","loadRes","err","spriteFrame","message","x","i","card","instantiate","scale","parent","name","height","y","push"],"mappings":"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","file":"player_node.js","sourceRoot":"../../../../../../assets/scripts/gameScene/prefabs","sourcesContent":["import myglobal from \"../../mygolbal.js\"\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        account_label:cc.Label,\n        nickname_label:cc.Label,\n        room_touxiang:cc.Sprite,\n        globalcount_label:cc.Label,\n        headimage:cc.Sprite,\n        readyimage:cc.Node,\n        offlineimage:cc.Node,\n        card_node:cc.Node,\n        card_prefab:cc.Prefab,\n        //tips_label:cc.Label,\n        clockimage:cc.Node,\n        qiangdidzhu_node:cc.Node, //抢地主的父节点\n        time_label:cc.Label,\n        robimage_sp:cc.SpriteFrame,\n        robnoimage_sp:cc.SpriteFrame,\n        robIconSp: cc.Sprite,\n        robIcon_Sp:cc.Node,\n        robnoIcon_Sp:cc.Node,\n        masterIcon:cc.Node,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n      this.readyimage.active = false\n      this.offlineimage.active = false\n      \n      //监听开始游戏事件(客户端发给客户端)\n      this.node.on(\"gamestart_event\",function(event){\n        this.readyimage.active = false\n      }.bind(this))\n\n      //给其他玩家发牌事件\n      this.node.on(\"push_card_event\",function(event){\n        console.log(\"on push_card_event\")\n        //自己不再发牌\n        if(this.accountid==myglobal.playerData.accountID){\n            return\n        }\n        this.pushCard()\n      }.bind(this))\n\n      this.node.on(\"playernode_rob_state_event\",function(event){\n          //{\"accountid\":\"2162866\",\"state\":1}\n          var detail = event\n      \n          //如果是自己在抢，需要隐藏qiangdidzhu_node节点\n          //this.accountid表示这个节点挂接的accountid\n          if(detail.accountid==this.accountid){\n            //console.log(\"detail.accountid\"+detail.accountid)\n            this.qiangdidzhu_node.active = false\n              \n          }\n\n          if(this.accountid == detail.accountid){\n            if(detail.state==qian_state.qian){\n             \n              console.log(\"this.robIcon_Sp.active = true\")\n              this.robIcon_Sp.active = true\n\n            }else if(detail.state==qian_state.buqiang){\n              this.robnoIcon_Sp.active = true\n             \n            }else{\n              console.log(\"get rob value :\"+detail.state)\n            }\n          }\n         \n      }.bind(this))\n\n      this.node.on(\"playernode_changemaster_event\",function(event){\n         var detail = event \n         this.robIcon_Sp.active = false\n         this.robnoIcon_Sp.active = false\n         if(detail==this.accountid){\n            this.masterIcon.active = true\n          }\n      }.bind(this))\n\n      // this.node.on(\"playernode_add_three_card\",function(event){\n      //   var detail = event //地主的accountid\n      //   if(detail==this.accountid){\n      //     //给地主发三张排\n\n      //   }\n      // }.bind(this))\n    },\n\n    start () {\n        \n    },\n\n    //这里初始化房间内位置节点信息(自己和其他玩家)\n    //data玩家节点数据\n    //index玩家在房间的位置索引\n    init_data(data,index){\n      console.log(\"init_data:\"+JSON.stringify(data))  \n      //data:{\"accountid\":\"2117836\",\"nick_name\":\"tiny543\",\"avatarUrl\":\"http://xxx\",\"goldcount\":1000}\n      this.accountid = data.accountid\n      this.account_label.string = data.accountid\n      this.nickname_label.string = data.nick_name\n      this.globalcount_label.string = data.goldcount\n      this.cardlist_node = []\n      this.seat_index = index\n      if(data.isready==true){\n        this.readyimage.active = true\n      }\n\n      //网络图片加载\n    //     cc.loader.load({url: data.avatarUrl, type: 'jpg'},  (err, tex)=> {\n    //     //cc.log('Should load a texture from RESTful API by specify the type: ' + (tex instanceof cc.Texture2D));\n    //     let oldWidth = this.headImage.node.width;\n    //     //console.log('old withd' + oldWidth);\n    //     this.room_touxiang.spriteFrame = new cc.SpriteFrame(tex);\n    //     let newWidth = this.headImage.node.width;\n    //     //console.log('old withd' + newWidth);\n    //     this.headImage.node.scale = oldWidth / newWidth;\n    // });\n    //这里根据传入的avarter来获取本地图像\n    var str = data.avatarUrl\n    //console.log(str)\n    var head_image_path = \"UI/headimage/\" + str\n    cc.loader.loadRes(head_image_path,cc.SpriteFrame,function(err,spriteFrame) {\n        if (err) {\n            console.log(err.message || err);\n            return;\n        }          \n         this.headimage.spriteFrame = spriteFrame;        \n        }.bind(this));\n\n    //注册一个player_ready消息\n    this.node.on(\"player_ready_notify\",function(event){\n        console.log(\"player_ready_notify event\",event)\n            var detail = event\n            console.log(\"------player_ready_notify detail:\"+detail)\n            if(detail==this.accountid){\n                this.readyimage.active = true\n            }\n        }.bind(this))\n\n        //监听内部随可以抢地主消息,这个消息会发给每个playernode节点\n        this.node.on(\"playernode_canrob_event\",function(event){\n            var detail = event\n            console.log(\"------playernode_canrob_event detail:\"+detail)\n            if(detail==this.accountid){\n              this.qiangdidzhu_node.active=true\n              //this.tips_label.string =\"正在抢地主\" \n              this.time_label.string=\"10\"\n              //开启一个定时器\n\n            }\n        }.bind(this))\n        //?\n        if(index==1){\n          this.card_node.x = -this.card_node.x - 30\n        }\n    },\n\n    // update (dt) {},\n    pushCard(){\n        \n        this.card_node.active = true \n        for(var i=0;i<17;i++){\n            var card = cc.instantiate(this.card_prefab)\n            card.scale=0.6\n            console.log(\" this.card_node.parent.parent\"+ this.card_node.parent.parent.name)\n            card.parent = this.card_node\n            //card.parent = this.node\n            var height = card.height\n            card.y = (17 - 1) * 0.5 * height * 0.4 * 0.3 - height * 0.4 * 0.3 * i;\n            card.x = 0\n           \n            //console.log(\"call pushCard x:\"+card.x+\" y:\"+card.y)\n            this.cardlist_node.push(card)\n        }\n    },\n});\n"]}