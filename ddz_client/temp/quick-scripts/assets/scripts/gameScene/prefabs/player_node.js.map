{"version":3,"sources":["player_node.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../../../assets/scripts/gameScene/prefabs","sourcesContent":["import myglobal from \"../../mygolbal\"\nimport { qian_state } from '../../defines'\nconst { ccclass, property } = cc._decorator;\n@ccclass\nexport class player_node extends cc.Component {\n\n  @property(cc.Label)\n  account_label: cc.Label = null;\n  @property(cc.Label)\n  nickname_label: cc.Label = null;\n  @property(cc.Sprite)\n  room_touxiang: cc.Sprite = null;\n  @property(cc.Label)\n  globalcount_label: cc.Label = null;\n  @property(cc.Sprite)\n  headimage: cc.Sprite = null;\n  @property(cc.Node)\n  readyimage: cc.Node = null;\n  @property(cc.Node)\n  offlineimage: cc.Node = null;\n  @property(cc.Node)\n  card_node: cc.Node = null;\n  @property(cc.Prefab)\n  card_prefab: cc.Prefab = null;\n  @property(cc.Node)\n  //tips_label:cc.Label = null;\n  clockimage: cc.Node = null\n  @property(cc.Node)\n  qiangdidzhu_node: cc.Node =null//抢地主的父节点 = null; \n  @property(cc.Label)\n  time_label: cc.Label = null;\n  @property(cc.SpriteFrame)\n  robimage_sp: cc.SpriteFrame = null;\n  @property(cc.SpriteFrame)\n  robnoimage_sp: cc.SpriteFrame = null;\n  @property(cc.Sprite)\n  robIconSp: cc.Sprite = null;\n  @property(cc.Node)\n  robIcon_Sp: cc.Node = null;\n  @property(cc.Node)\n  robnoIcon_Sp: cc.Node = null;\n  @property(cc.Node)\n  masterIcon: cc.Node = null;\n\n\n\n  accountid\n  cardlist_node\n  seat_index\n\n  // LIFE-CYCLE CALLBACKS:\n  onLoad() {\n    this.readyimage.active = false\n    this.offlineimage.active = false\n\n    //监听开始游戏事件(客户端发给客户端)\n    this.node.on(\"gamestart_event\", function (event) {\n      this.readyimage.active = false\n    }.bind(this))\n\n    //给其他玩家发牌事件\n    this.node.on(\"push_card_event\", function (event) {\n      console.log(\"on push_card_event\")\n      //自己不再发牌\n      if (this.accountid == myglobal.playerData.accountID) {\n        return\n      }\n      this.pushCard()\n    }.bind(this))\n\n    this.node.on(\"playernode_rob_state_event\", function (event) {\n      //{\"accountid\":\"2162866\",\"state\":1}\n      var detail = event\n\n      //如果是自己在抢，需要隐藏qiangdidzhu_node节点\n      //this.accountid表示这个节点挂接的accountid\n      if (detail.accountid == this.accountid) {\n        //console.log(\"detail.accountid\"+detail.accountid)\n        this.qiangdidzhu_node.active = false\n\n      }\n\n      if (this.accountid == detail.accountid) {\n        if (detail.state == qian_state.qian) {\n\n          console.log(\"this.robIcon_Sp.active = true\")\n          this.robIcon_Sp.active = true\n\n        } else if (detail.state == qian_state.buqiang) {\n          this.robnoIcon_Sp.active = true\n\n        } else {\n          console.log(\"get rob value :\" + detail.state)\n        }\n      }\n\n    }.bind(this))\n\n    this.node.on(\"playernode_changemaster_event\", function (event) {\n      var detail = event\n      this.robIcon_Sp.active = false\n      this.robnoIcon_Sp.active = false\n      if (detail == this.accountid) {\n        this.masterIcon.active = true\n      }\n    }.bind(this))\n\n    // this.node.on(\"playernode_add_three_card\",function(event){\n    //   var detail = event //地主的accountid\n    //   if(detail==this.accountid){\n    //     //给地主发三张排\n\n    //   }\n    // }.bind(this))\n  }\n\n  start() {\n\n  }\n\n  //这里初始化房间内位置节点信息(自己和其他玩家)\n  //data玩家节点数据\n  //index玩家在房间的位置索引\n  init_data(data, index) {\n    console.log(\"init_data:\" + JSON.stringify(data))\n    //data:{\"accountid\":\"2117836\",\"nick_name\":\"tiny543\",\"avatarUrl\":\"http://xxx\",\"goldcount\":1000}\n    this.accountid = data.accountid\n    this.account_label.string = data.accountid\n    this.nickname_label.string = data.nick_name\n    this.globalcount_label.string = data.goldcount\n    this.cardlist_node = []\n    this.seat_index = index\n    if (data.isready == true) {\n      this.readyimage.active = true\n    }\n\n    //网络图片加载\n    //     cc.loader.load({url: data.avatarUrl, type: 'jpg'},  (err, tex)=> {\n    //     //cc.log('Should load a texture from RESTful API by specify the type: ' + (tex instanceof cc.Texture2D));\n    //     let oldWidth = this.headImage.node.width;\n    //     //console.log('old withd' + oldWidth);\n    //     this.room_touxiang.spriteFrame = new cc.SpriteFrame(tex);\n    //     let newWidth = this.headImage.node.width;\n    //     //console.log('old withd' + newWidth);\n    //     this.headImage.node.scale = oldWidth / newWidth;\n    // });\n    //这里根据传入的avarter来获取本地图像\n    var str = data.avatarUrl\n    //console.log(str)\n    var head_image_path = \"UI/headimage/\" + str\n    cc.loader.loadRes(head_image_path, cc.SpriteFrame, function (err, spriteFrame) {\n      if (err) {\n        console.log(err.message || err);\n        return;\n      }\n      this.headimage.spriteFrame = spriteFrame;\n    }.bind(this));\n\n    //注册一个player_ready消息\n    this.node.on(\"player_ready_notify\", function (event) {\n      console.log(\"player_ready_notify event\", event)\n      var detail = event\n      console.log(\"------player_ready_notify detail:\" + detail)\n      if (detail == this.accountid) {\n        this.readyimage.active = true\n      }\n    }.bind(this))\n\n    //监听内部随可以抢地主消息,这个消息会发给每个playernode节点\n    this.node.on(\"playernode_canrob_event\", function (event) {\n      var detail = event\n      console.log(\"------playernode_canrob_event detail:\" + detail)\n      if (detail == this.accountid) {\n        this.qiangdidzhu_node.active = true\n        //this.tips_label.string =\"正在抢地主\" \n        console.log('this->',this)\n        this.time_label.string = \"10\"\n        //开启一个定时器\n\n      }\n    }.bind(this))\n    //?\n    if (index == 1) {\n      this.card_node.x = -this.card_node.x - 30\n    }\n  }\n\n  // update (dt) {},\n  pushCard() {\n\n    this.card_node.active = true\n    for (var i = 0; i < 17; i++) {\n      var card = cc.instantiate(this.card_prefab)\n      card.scale = 0.6\n      console.log(\" this.card_node.parent.parent\" + this.card_node.parent.parent.name)\n      card.parent = this.card_node\n      //card.parent = this.node\n      var height = card.height\n      card.y = (17 - 1) * 0.5 * height * 0.4 * 0.3 - height * 0.4 * 0.3 * i;\n      card.x = 0\n\n      //console.log(\"call pushCard x:\"+card.x+\" y:\"+card.y)\n      this.cardlist_node.push(card)\n    }\n  }\n}\n"]}